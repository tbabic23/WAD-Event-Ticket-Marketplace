<aside class="sidebar" [class.open]="true">

    <div class="sidebar-logo">
        <h1><a routerLink="/" class="logo-link">TicketMarket</a></h1>
    </div>

    <h2>Search & Filter</h2>
    <div class="filter-group">
        <label>Search by Name</label>
        <input type="text" [(ngModel)]="search" (input)="onFilterChange()" placeholder="Event name...">
    </div>

    <div class="filter-group">
        <label>Location</label>
        <select [(ngModel)]="selectedLocation" (change)="onFilterChange()">
            <option value="">All Locations</option>
            <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
        </select>
    </div>

    <div class="filter-group">
        <label>Start Date From</label>
        <input type="date" [(ngModel)]="selectedDate" (change)="onFilterChange()">
    </div>

    <div class="filter-group">
        <label>Start Date Until</label>
        <input type="date" [(ngModel)]="selectedDateUntil" (change)="onFilterChange()">
    </div>

    <div class="filter-group">
        <label>Category</label>
        <select [(ngModel)]="selectedCategory" (change)="onFilterChange()">
            <option value="">All Categories</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
    </div>

    <div class="filter-group">
        <label>Sort by Date</label>
        <select [(ngModel)]="sortBy" (change)="onFilterChange()">
            <option value="soonest">Soonest</option>
            <option value="latest">Latest</option>
        </select>
    </div>

    <div class="filter-group">
        <label>
            <input type="checkbox" [(ngModel)]="confirmedOnly" (change)="onFilterChange()"> Confirmed Events Only
        </label>
    </div>

    <div class="sidebar-bottom">
        <button *ngIf="canCreateEvents" class="create-event-btn" (click)="openCreateModal()">
            Create Event
        </button>
    </div>
</aside>

<main class="container content">
    <section class="marketplace">
        <div class="card" *ngFor="let event of events">
            <div class="image-placeholder" [style.background-image]="event.image_url ? 'url(' + event.image_url + ')' : ''">
                <span *ngIf="!event.image_url">Sample Image</span>
            </div>
            <div class="card-title-row">
                <h3>{{ event.title }}</h3>
                <span class="confirmed-badge" *ngIf="event.confirmed">Confirmed</span>
            </div>
            <p class="event-date">{{ formatEventDate(event.event_date, event.event_end_date) }}</p>
            <p class="venue">{{ event.venue }}{{ event.city ? ' • ' + event.city : '' }}</p>

            <button *ngIf="!isEventCreator(event) && !isAdmin()" (click)="buyTicket(event)">Buy Ticket</button>

            <div *ngIf="isEventCreator(event) || isAdmin()" class="creator-actions">
                <button class="manage-btn" (click)="openManageModal(event.id)">Manage Event</button>
            </div>
        </div>
    </section>

    <app-event-modal *ngIf="showModal"
                     (close)="closeModal()"
                     (eventCreated)="onEventCreated()">
    </app-event-modal>

    <app-manage-event-modal *ngIf="showManageModal && selectedEventId"
                            [eventId]="selectedEventId"
                            (close)="closeManageModal()">
    </app-manage-event-modal>

    <app-buy-ticket-modal *ngIf="showBuyModal && selectedEvent"
                          [event]="selectedEvent"
                          (close)="closeBuyModal()"
                          (purchaseComplete)="onPurchaseComplete()">
    </app-buy-ticket-modal>

</main>
